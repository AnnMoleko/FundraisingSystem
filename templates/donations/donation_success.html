{% extends 'base.html' %}
{% load static %}

{% block title %}Donation Successful - EduFund{% endblock %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="max-w-3xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="p-8 md:p-12 text-center">
            <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-[#EAF6F6] mb-6 animate-scale-in">
                <svg class="h-10 w-10 text-[#2B6D6D]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            
            <h1 class="text-4xl font-extrabold text-[#1A2A80] mb-2">Thank You!</h1>
            <p class="text-xl text-gray-600 mb-8">Your donation has been successfully processed.</p>
            
            <div class="bg-gradient-to-br from-[#E0E7FF] to-[#D1F7E9] border border-[#3B38A0] rounded-2xl p-6 md:p-8 mb-8 text-left shadow-inner">
                <h2 class="text-xl font-bold text-[#1A2A80] mb-4">Donation Details</h2>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Amount Donated</dt>
                        <dd class="text-2xl font-bold text-[#2B6D6D] mt-1">R{{ donation.amount }}</dd>
                    </div>
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Campaign</dt>
                        <dd class="text-base text-gray-900 font-semibold mt-1">{{ donation.campaign.title }}</dd>
                    </div>
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Student</dt>
                        <dd class="text-base text-gray-900 mt-1">{{ donation.campaign.student.full_name|default:donation.campaign.student.username }}</dd>
                    </div>
                    
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Payment Method</dt>
                        <dd class="text-base text-gray-900 mt-1">{{ donation.get_payment_method_display }}</dd>
                    </div>
                    
                    <div class="col-span-1 sm:col-span-2">
                        <dt class="text-sm font-medium text-gray-500">Transaction ID</dt>
                        <dd class="text-sm text-gray-900 font-mono mt-1">{{ donation.id }}</dd>
                    </div>
                    
                    <div class="col-span-1 sm:col-span-2">
                        <dt class="text-sm font-medium text-gray-500">Date</dt>
                        <dd class="text-sm text-gray-900 mt-1">{{ donation.completed_at|date:"F d, Y, g:i A" }}</dd>
                    </div>
                </div>
                
                {% if donation.message %}
                <div class="mt-6 pt-6 border-t border-gray-300">
                    <dt class="text-sm font-medium text-gray-500 mb-2">Your Message</dt>
                    <dd class="text-base text-gray-900 italic">"{{ donation.message }}"</dd>
                </div>
                {% endif %}
            </div>
            
            <div class="bg-gray-50 border border-gray-200 rounded-2xl p-6 md:p-8 mb-8 text-left">
                <h3 class="text-xl font-bold text-[#1A2A80] mb-3">Your Impact</h3>
                <p class="text-gray-700">
                    Your generous donation of <strong class="text-[#2B6D6D]">R{{ donation.amount }}</strong> brings 
                    <strong>{{ donation.campaign.student.full_name|default:donation.campaign.student.username }}</strong> 
                    closer to their educational goal!
                </p>
                
                <div class="mt-4">
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span class="font-medium">Campaign Progress</span>
                        <span>R{{ donation.campaign.current_amount|floatformat:0 }} of R{{ donation.campaign.goal|floatformat:0 }}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-[#5A67D8] to-[#2B6D6D] h-3 rounded-full transition-all duration-1000" 
                             style="width: {{ donation.campaign.progress_percentage }}%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">{{ donation.campaign.progress_percentage|floatformat:0 }}% funded</p>
                </div>
            </div>
            
            <div class="mb-8">
                <h3 class="text-xl font-bold text-[#1A2A80] mb-6">What happens next?</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
                    <div class="flex flex-col items-center p-6 bg-[#E0E7FF] rounded-2xl">
                        <svg class="w-8 h-8 text-[#3B38A0] mb-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>
                        <h4 class="font-semibold text-gray-900 mt-1">Email Confirmation</h4>
                        <p class="text-gray-600 text-center mt-2">You'll receive a confirmation email with your receipt shortly.</p>
                    </div>
                    <div class="flex flex-col items-center p-6 bg-[#F0ECFA] rounded-2xl">
                        <svg class="w-8 h-8 text-[#5A67D8] mb-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                        <h4 class="font-semibold text-gray-900 mt-1">Funds Transferred</h4>
                        <p class="text-gray-600 text-center mt-2">Your donation goes directly to the student to support their needs.</p>
                    </div>
                    <div class="flex flex-col items-center p-6 bg-[#EAF6F6] rounded-2xl">
                        <svg class="w-8 h-8 text-[#2B6D6D] mb-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
                        <h4 class="font-semibold text-gray-900 mt-1">Student Notified</h4>
                        <p class="text-gray-600 text-center mt-2">The student will be notified of your generous support.</p>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                <a href="{% url 'campaign_detail' donation.campaign.id %}" 
                   class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-semibold rounded-full shadow-sm text-white bg-[#3B38A0] hover:bg-opacity-90 transition-colors duration-200">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Back to Campaign
                </a>
                
                <a href="{% url 'campaigns_list' %}" 
                   class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-semibold rounded-full shadow-sm text-white bg-[#2B6D6D] hover:bg-opacity-90 transition-colors duration-200">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    Find More Campaigns
                </a>
            </div>

            <div class="mt-8 pt-8 border-t border-gray-200">
                <p class="text-sm text-gray-600 mb-4">Help spread the word about this campaign:</p>
                <div class="flex justify-center space-x-4">
                    <button onclick="shareOnFacebook()" class="text-[#3B5998] hover:text-opacity-80 transition-colors duration-200">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14 13.5h2.5l1-4H14v-2c0-1.03 0-2.075 2-2.075h.927V3.27c-.43-.058-1.72-.165-3.238-.165-3.228 0-5.5 1.767-5.5 5.922V13.5H6v4h2.5V22h4V17.5h3.35l.65-4H14z"></path></svg>
                    </button>
                    <button onclick="shareOnTwitter()" class="text-[#1DA1F2] hover:text-opacity-80 transition-colors duration-200">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.37-.83.5-1.75.85-2.72 1.05-.78-.83-1.88-1.35-3.13-1.35-2.36 0-4.28 1.9-4.28 4.25 0 .33.04.66.12.97-3.56-.18-6.72-1.89-8.83-4.48-.37.64-.58 1.39-.58 2.19 0 1.47.74 2.77 1.88 3.53-.69-.02-1.34-.2-1.92-.53v.05c0 2.05 1.46 3.76 3.4 4.15-.36.1-.73.15-1.12.15-.27 0-.54-.03-.79-.08.54 1.68 2.1 2.91 3.96 2.94-1.46 1.14-3.3 1.82-5.3 1.82-.35 0-.7-.02-1.04-.06 1.89 1.21 4.14 1.92 6.6 1.92 7.9 0 12.23-6.55 12.23-12.23 0-.19-.01-.38-.01-.56.84-.61 1.56-1.37 2.14-2.22z"></path></svg>
                    </button>
                    <button onclick="shareOnLinkedIn()" class="text-[#0077B5] hover:text-opacity-80 transition-colors duration-200">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4.98 3.5c0 .64-.53 1.15-1.17 1.15-.64 0-1.17-.51-1.17-1.15S3.17 2.35 3.81 2.35c.64 0 1.17.51 1.17 1.15zM2.83 5.9h2.36V22h-2.36V5.9zm4.07 0h2.36v16.1h-2.36V5.9zm8.56 0h2.36V9.3h-.04c.3-.43.83-.88 1.77-1.16C19.8 8.08 21 9.4 21 12.18V22h-2.36V12.18c0-2.36-.63-4.25-2.4-4.25-1.3 0-2.07.89-2.4 1.78v-1.78z"></path></svg>
                    </button>
                    <button onclick="shareViaEmail()" class="text-gray-600 hover:text-gray-800 transition-colors duration-200">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.52c.2-.5.5-.9 1.1-1.3l.2-.2c.5-.4 1.2-.6 1.9-.7h17.5c.7.1 1.4.3 1.9.7l.2.2c.6.4 1 1.1 1.1 1.6V18c0 .7-.1 1.2-.4 1.7l-.3.3c-.4.4-1 .6-1.6.6H2.9c-.6 0-1.2-.2-1.6-.6l-.3-.3c-.3-.5-.4-1-.4-1.7V3.52zM21 18.2V5.8l-8.4 6.7c-.5.4-1 .6-1.6.6-.5 0-1-.2-1.6-.6L3 5.8v12.4H21zM10.2 12.4l-6.8-5.4V4.9L10.2 10l6.8-5.1v2.1l-6.8 5.4z"></path></svg>
                    </button>
                </div>
            </div>
            
        </div>
    </div>
</div>

<style>
    @keyframes scale-in {
        from { transform: scale(0); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
    .animate-scale-in {
        animation: scale-in 0.5s ease-out forwards;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const progressBar = document.querySelector('.bg-gradient-to-r');
        if (progressBar) {
            const width = progressBar.style.width;
            progressBar.style.width = '0%';
            setTimeout(() => {
                progressBar.style.width = width;
            }, 800);
        }
    });

    function shareOnFacebook() {
        const url = encodeURIComponent(window.location.origin + '{% url "campaign_detail" donation.campaign.id %}');
        const text = encodeURIComponent('I just supported {{ donation.campaign.title }} - Help {{ donation.campaign.student.full_name|default:donation.campaign.student.username }} reach their educational goals!');
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
    }

    function shareOnTwitter() {
        const url = encodeURIComponent(window.location.origin + '{% url "campaign_detail" donation.campaign.id %}');
        const text = encodeURIComponent('I just supported {{ donation.campaign.title }} on @EduFund! Help {{ donation.campaign.student.full_name|default:donation.campaign.student.username }} reach their educational goals! 🎓💙');
        window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
    }

    function shareOnLinkedIn() {
        const url = encodeURIComponent(window.location.origin + '{% url "campaign_detail" donation.campaign.id %}');
        const title = encodeURIComponent('Supporting Education: {{ donation.campaign.title }}');
        const summary = encodeURIComponent('I just made a donation to help {{ donation.campaign.student.full_name|default:donation.campaign.student.username }} achieve their educational goals. Join me in supporting education!');
        window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}&summary=${summary}`, '_blank');
    }

    function shareViaEmail() {
        const subject = encodeURIComponent('Help Support {{ donation.campaign.title }}');
        const body = encodeURIComponent(`Hi,
        
I just made a donation to support {{ donation.campaign.student.full_name|default:donation.campaign.student.username }}'s educational campaign: "{{ donation.campaign.title }}"
        
You can learn more and make a donation here: ${window.location.origin}{% url "campaign_detail" donation.campaign.id %}
        
Every contribution, no matter the size, makes a difference in helping students achieve their educational dreams.
        
Best regards`);
        
        window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }
</script>
{% endblock %}